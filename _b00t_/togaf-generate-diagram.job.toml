[b00t]
name = "togaf-generate-diagram"
type = "job"
hint = "Generate TOGAF/PlantUML diagrams (SVG, PNG) using MCP server for enterprise architecture governance"

[b00t.job]
description = "Automated diagram generation for TOGAF workflows using PlantUML MCP server"
tags = ["togaf", "plantuml", "diagram", "governance", "mcp"]
requires = ["plantuml.mcp", "plantuml-server-b00t.docker"]

[b00t.job.config]
mode = "sequential"
checkpoint_mode = "auto"
checkpoint_after_each_step = true
output_dir = "~/.b00t/data/togaf/diagrams"

# Environment variables for diagram generation
[b00t.job.env]
PLANTUML_SERVER_URL = "http://localhost:8080/plantuml"
PLANTUML_FORMAT = "svg"  # svg or png
DIAGRAM_OUTPUT_DIR = "~/.b00t/data/togaf/diagrams"

[[b00t.job.steps]]
name = "setup-output-dir"
description = "Create output directory for generated diagrams"
checkpoint = "setup-complete"

[b00t.job.steps.task]
type = "bash"
command = "mkdir -p ~/.b00t/data/togaf/diagrams"

[[b00t.job.steps]]
name = "start-plantuml-server"
description = "Ensure PlantUML server container is running"
checkpoint = "server-started"

[b00t.job.steps.task]
type = "bash"
command = """
docker ps | grep -q plantuml-b00t || \
docker run -d --name plantuml-b00t -p 8080:8080 \
  ghcr.io/promptexecution/plantuml-server--b00t--togaf--mcp:latest && \
sleep 3 && \
echo '‚úÖ PlantUML server ready'
"""

[[b00t.job.steps]]
name = "generate-diagram"
description = "Generate diagram using PlantUML MCP server"
checkpoint = "diagram-generated"

# ü§ì: This step uses MCP tools via Task agent or direct MCP call
# Example PlantUML code for TOGAF ADM (Architecture Development Method)
[b00t.job.steps.task]
type = "mcp-plantuml"
description = "Generate TOGAF ADM cycle diagram"

# ü§ì: Example diagram - replace with actual TOGAF diagram source
[b00t.job.steps.task.plantuml]
source = """
@startuml
!define TOGAF
skinparam backgroundColor #FEFEFE
skinparam roundcorner 15

title TOGAF ADM - Architecture Development Method

package "Preliminary Phase" {
  [Prepare Organization]
}

package "Phase A: Architecture Vision" {
  [Define Scope]
  [Identify Stakeholders]
  [Create Vision]
}

package "Phase B: Business Architecture" {
  [Baseline Business]
  [Target Business]
  [Gap Analysis]
}

package "Phase C: Information Systems" {
  [Data Architecture]
  [Application Architecture]
}

package "Phase D: Technology Architecture" {
  [Technology Components]
  [Standards]
}

package "Phase E: Opportunities & Solutions" {
  [Implementation Plan]
  [Migration Strategy]
}

package "Phase F: Migration Planning" {
  [Detailed Roadmap]
  [Cost/Benefit]
}

package "Phase G: Implementation Governance" {
  [Architecture Contracts]
  [Compliance Reviews]
}

package "Phase H: Architecture Change Management" {
  [Monitor Changes]
  [Update Baseline]
}

[Prepare Organization] --> [Define Scope]
[Create Vision] --> [Baseline Business]
[Gap Analysis] --> [Data Architecture]
[Application Architecture] --> [Technology Components]
[Standards] --> [Implementation Plan]
[Migration Strategy] --> [Detailed Roadmap]
[Cost/Benefit] --> [Architecture Contracts]
[Compliance Reviews] --> [Monitor Changes]
[Update Baseline] --> [Prepare Organization] : "Iterate"

center footer TOGAF ADM Cycle - Generated by b00t
@enduml
"""

format = "svg"  # Output format: svg or png
output_file = "~/.b00t/data/togaf/diagrams/togaf-adm-cycle.svg"

[[b00t.job.steps]]
name = "verify-output"
description = "Verify diagram file was generated successfully"
checkpoint = "verify-complete"

[b00t.job.steps.task]
type = "bash"
command = """
if [ -f ~/.b00t/data/togaf/diagrams/togaf-adm-cycle.svg ]; then
  file_size=$(stat -f%z ~/.b00t/data/togaf/diagrams/togaf-adm-cycle.svg 2>/dev/null || stat -c%s ~/.b00t/data/togaf/diagrams/togaf-adm-cycle.svg)
  echo "‚úÖ Diagram generated: togaf-adm-cycle.svg (${file_size} bytes)"
  ls -lh ~/.b00t/data/togaf/diagrams/
else
  echo "‚ùå Diagram generation failed"
  exit 1
fi
"""

[[b00t.usage]]
description = "Generate TOGAF ADM diagram (default SVG)"
command = "b00t job run togaf-generate-diagram"

[[b00t.usage]]
description = "Generate diagram as PNG instead of SVG"
command = "PLANTUML_FORMAT=png b00t job run togaf-generate-diagram"

[[b00t.usage]]
description = "Generate diagram with custom output directory"
command = "DIAGRAM_OUTPUT_DIR=/tmp/diagrams b00t job run togaf-generate-diagram"

[[b00t.usage]]
description = "Check job status"
command = "b00t job status togaf-generate-diagram"

[[b00t.references]]
name = "TOGAF ADM Overview"
url = "https://pubs.opengroup.org/architecture/togaf9-doc/arch/chap05.html"

[[b00t.references]]
name = "PlantUML Component Diagrams"
url = "https://plantuml.com/component-diagram"

[[b00t.references]]
name = "TOGAF with PlantUML Examples"
url = "https://github.com/joelparkerhenderson/demo-plantuml/tree/main/examples/togaf"
