apiVersion: k0s.k0sproject.io/v1beta1
kind: ClusterConfig
metadata:
  name: k0s
spec:
  api:
    address: 0.0.0.0
    externalAddress: "{{ hostvars[inventory_hostname].get('k0s_external_address', ansible_host | default(ansible_default_ipv4.address)) }}"
  storage:
    type: etcd
  controllerManager:
    leaderElection:
      leaseDuration: 15s
  telemetry:
    enabled: true
  runtime:
    type: containerd
    containerd:
      defaultRuntime: runc
      runtimeClasses:
        - name: "{{ kata_runtime_class }}"
          runtimeHandler: kata
      containerdConfigPatches:
        - |
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.kata]
            runtime_type = "io.containerd.kata.v2"
            privileged_without_host_devices = false
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.kata.options]
            ConfigPath = "/usr/share/defaults/kata-containers/configuration-qemu.toml"
  workerProfiles:
    - name: default
      values:
        taints: []
